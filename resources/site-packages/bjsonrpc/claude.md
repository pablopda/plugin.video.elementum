# bjsonrpc

## Purpose

Bidirectional JSON-RPC library for communication between the Python plugin and the Go daemon.

## Modules

- **__init__.py** - Package exports
- **connection.py** - TCP/socket connection management
- **server.py** - JSON-RPC server implementation
- **handlers.py** - BaseHandler for method routing
- **proxies.py** - Proxy objects for remote calls
- **request.py** - Request handling
- **exceptions.py** - Custom exceptions
- **jsonlib.py** - JSON utilities
- **main.py** - Main entry points
- **varsync/** - Variable synchronization

## Key Classes

### BaseHandler
Base class for RPC method handlers:
```python
class ElementumRPCServer(BaseHandler):
    def Ping(self):
        return "pong"
```

### Connection
Manages TCP socket connections:
- Bi-directional communication
- Keep-alive handling
- Error recovery

### Server
JSON-RPC server:
- Listens on specified port
- Routes method calls to handlers
- Manages client connections

## Usage

In `rpc.py`:
```python
from bjsonrpc.handlers import BaseHandler
from bjsonrpc import server

class ElementumRPCServer(BaseHandler):
    def Ping(self):
        return "pong"

    def Refresh(self):
        xbmc.executebuiltin("Container.Refresh")

# Start server
srv = server.Server(host, port, handler_factory=ElementumRPCServer)
srv.serve()
```

## Protocol

JSON-RPC 2.0 format:
```json
{
  "jsonrpc": "2.0",
  "method": "Ping",
  "params": [],
  "id": 1
}
```

Response:
```json
{
  "jsonrpc": "2.0",
  "result": "pong",
  "id": 1
}
```

## Notes

- Runs on port 65221 by default
- Separate from HTTP API (port 65220)
- Supports method calls in both directions
- Used for Kodi UI control from daemon
